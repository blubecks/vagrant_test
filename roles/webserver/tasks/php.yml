---
- name: install php
  yum: pkg={{ item }} state=installed
  with_items:
    - php5-fpm
    - php5-cli
    - php5-common
    - php5-curl
    - php5-json
    - php-pear
    - php5-gd
    - mcrypt
    - php5-mcrypt
    - php5-mysql
    - php5-xmlrpc
    - libapache2-mod-php5


- name: Downloading phpmyadmin stable if isn't downloaded yet
  shell: cd /var/www && git clone --depth 1 -b STABLE --single-branch https://github.com/phpmyadmin/phpmyadmin.git

   # echo "Copy parameters.yml and create database"
   # cp -f /vagrant/config/symfony/parameters.yml /var/www/symfony/app/config/parameters.yml

- name: Copy conf for apache
  template: src=phpmyadmin.tpl dest=/etc/httpd/conf.d/phpmyadmin.conf owner=root group=root mode=0644

- name: Add default username and password for MySQL connection.
  lineinfile: >
    dest=/etc/phpmyadmin/config.inc.php
    state=present
    regexp="^.+\['{{ item.key }}'\].+$"
    line="$cfg['Servers'][$i]['{{ item.key }}'] = '{{ item.value }}';"
    insertbefore="^\?>"
  with_items:
    - { key: user, value: "root" }
    - { key: password, value: "root"}
  notify:
    - restart httpd
