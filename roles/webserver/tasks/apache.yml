---
- name: install apache
  apt: name=apache2 state=present
- name: copy across new virtual host
  template:
    src=virtual-hosts.conf.j2
    dest=/etc/apache2/sites-available/laravelHost.conf
  notify:
    - reload apache
- name: enable new vagrant virtual host
  file:
    src=/etc/apache2/sites-available/laravelHost.conf
    dest=/etc/apache2/sites-enabled/laravelHost.conf
    state=link
  notify:
    - reload apache
- name: change apache user and group
  replace: >
    dest=/etc/apache2/envvars
    regexp="^(export APACHE_RUN_(USER|GROUP)=)www-data"
    replace="\1vagrant"
    backup=yes
  notify:
    - reload apache
- name: change owner of apache.lock
  file: >
    path="/var/lock/apache2"
    owner=vagrant
    group=www-data
